{% load compress %}
{% load static %}
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vitalis - Votre partenaire sant√©</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans&display=swap" rel="stylesheet">
    <link href="{% static 'src/output.css' %}" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            color: #0a0803;
        }

        .hero-section {
            background-image: url('/api/placeholder/1920/1080');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255, 255, 255, 0.85), rgba(175, 194, 204, 0.7));
            z-index: 1;
        }

        .hero-content {
            position: relative;
            z-index: 2;
        }

        .medical-container {
            animation: pulse-gentle 4s infinite ease-in-out;
        }

        @keyframes pulse-gentle {
            0%, 100% { box-shadow: 0 0 20px 0 rgba(59, 130, 246, 0.3); }
            50% { box-shadow: 0 0 30px 5px rgba(59, 130, 246, 0.4); }
        }

        .heartbeat-line {
            animation: slide-right 12s infinite linear;
        }

        @keyframes slide-right {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        @keyframes gentle-pulse {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 0.5; }
        }

        .stethoscope, .medical-cross {
            animation: gentle-pulse 6s infinite ease-in-out;
        }
    </style>
</head>
<body class="min-h-screen bg-gray-100" >
    <!-- Navbar responsive -->
    <nav class=" shadow-md bg-white">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex-shrink-0 flex items-center">
                    <img src="{% static '../static/images/logo.jpg' %}" alt="Logo Vitalis" class="h-16 w-auto">
                    <div class=" text-3xl font-light" style="font-family: Pixelify"><span class="text-[#bd2c49] text-4xl">V</span>italis</div>
                </div>

                <!-- Navigation desktop -->
                <div class="hidden text-red md:flex items-center  gap-20 mx-4">
                    <a href="#acceuil" class="text-[#bd2c49] text-center hover:text-[#5e89ab]  font-medium">√Ä propos</a>
                    <a href="#services" class="text-[#bd2c49] text-center hover:text-[#5e89ab]  font-medium">Services</a>
                    <a href="#contact" class="text-[#bd2c49] text-center hover:text-[#5e89ab]  font-medium">Contact</a>
                </div>

                <!-- Menu burger mobile -->
                <div class="md:hidden flex items-center">
                    <button id="mobile-menu-button" class="text-[#0a0803] hover:text--[#5e89ab] focus:outline-none">
                        <svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Menu mobile -->
        <div id="mobile-menu" class="hidden md:hidden bg-white border-t border-gray-200">
            <div class="px-2 pt-2 pb-3 space-y-1">
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-[#0a0803] hover:bg--[#afc2cc] hover:text--[#5e89ab]">Accueil</a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-[#0a0803] hover:bg--[#afc2cc] hover:text--[#5e89ab]">√Ä propos</a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-[#0a0803] hover:bg--[#afc2cc] hover:text--[#5e89ab]">Services</a>
                <a href="#" class="block px-3 py-2 rounded-md text-base font-medium text-[#0a0803] hover:bg--[#afc2cc] hover:text--[#5e89ab]">Contact</a>
            </div>
        </div>
    </nav>
    <!-- Main Content -->
    <main>
        <section class="bg-cover bg-no-repeat bg-myimg p-10">
            <div class="flex flex-col items-center justify-center text-gray-900 h-screen">
                <h1 class="text-6xl font-extrabold animate-typewrite text-center mb-4">
                    Welcome to Vitalis
                    <p class="text-4xl">{{ user.FirstName.upper }}</p>
                </h1>
                <a href="#projects" class="bg-red text-white px-6 py-3 rounded-lg hover:bg-red transition-all duration-300 ease-in-out mt-6">Get Started</a>
                <h3 class="text-3xl font-bold mt-10">Your Healthcare AI Assistant</h3>
                <p class="text-lg text-gray-400 mt-4">Here to assist you with your healthcare needs.</p>
            </div>
        </section>

        <!-- User Info Section -->
        <section class="container mx-auto p-6 shadow-xl rounded-2xl mb-6 bg-white">
            <fieldset class="p-6 rounded-lg">
                <legend class="text-4xl font-extrabold text-neutral-900 mb-6 tracking-wide text-center">Your Data</legend>
                <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
                    <div class="bg-[#afc2cc] p-6 rounded-lg shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                        <p class="font-bold text-white">First Name:</p>
                        <h3 class="font-semibold text-white text-xl">{{ user.FirstName }}</h3>
                    </div>

                    <div class="bg-[#5e89ab] p-6 rounded-lg shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                        <p class="font-bold text-white">Last Name:</p>
                        <h3 class="font-semibold text-white text-xl">{{ user.LastName }}</h3>
                    </div>

                    <div class="bg-[#bd2c49] p-6 rounded-lg shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                        <p class="font-bold text-white">Age:</p>
                        <h3 class="font-semibold text-white text-xl">{{ user.get_age }}</h3>
                    </div>

                    <div class="bg-[#afc2cc] p-6 rounded-lg shadow-lg transform transition-all duration-300 hover:scale-105 hover:shadow-2xl">
                        <p class="font-bold text-white">Gender:</p>
                        <h3 class="font-semibold text-white text-xl">{{ user.Gender }}</h3>
                    </div>
                </div>

                <div class="text-center mt-6">
                    <a href="{% url 'user_edit' user.id %}" class="inline-block bg-[#bd2c49] text-white px-4 py-2 rounded shadow hover:bg-[#a6243a] transition">Edit Info</a>
                </div>
            </fieldset>
        </section>
        <div class="bg-white p-6 rounded-xl shadow-md max-w-4xl mx-auto mt-10 mb-20 h-full">
    <h2 class="text-xl font-bold mb-4 text-center ">Bracelet Data</h2>
    <ul class="space-y-3 text-gray-800">
        <li><strong>Temp√©rature moyenne :</strong> {{ moyennes.temperature_moyenne }} ¬∞C</li>
        <li><strong>BPM :</strong> {{ moyennes.bpm_moyen }}</li>
        <li><strong>SpO2 :</strong> {{ moyennes.spo2_moyen }} %</li>
        <li><strong>Tension art√©rielle :</strong> {{ moyennes.tension_systolique }}/{{ moyennes.tension_diastolique }} mmHg</li>
        <li><strong>Niveau de fatigue :</strong> {{ moyennes.niveau_fatigue }}</li>
    </ul>
</div>


        <!-- Charts Section -->
        <section class="max-w-7xl mx-auto grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
            <!-- Temperature -->
            <div class="bg-white shadow-xl rounded-2xl p-6">
                <h2 class="text-xl font-semibold mb-4">Temperature üå°Ô∏è</h2>
                <div class="chart-container">
                    <canvas id="tempChart"></canvas>
                </div>
            </div>

            <!-- BPM -->
            <div class="bg-white shadow-xl rounded-2xl p-6">
                <h2 class="text-xl font-semibold mb-4">Heart Rate ‚ù§Ô∏è</h2>
                <canvas id="bpmChart"></canvas>
            </div>

            <!-- SpO2 -->
            
            
        </section>

    </main>
    <div class="flex justify-center items-center min-h-screen">
    <div class="bg-white p-8 rounded-lg shadow-lg w-full max-w-md">
    <h1 class="text-2xl font-bold mb-6 text-center">Voice Interaction with AI</h1>
    <button id="startRecording" class="bg-green-500 text-white px-6 py-3 rounded-lg">Start Recording</button>
    <button id="stopRecording" class="bg-red-500 text-white px-6 py-3 rounded-lg disabled:opacity-50" disabled>Stop Recording</button>


    <div id="chatBox" class="mt-4"></div>

    <div id="textInputSection" class="mt-4">
        <input type="text" id="textMessage" class="border p-2 rounded-md w-full" placeholder="Type a message..." />
        <button class="bg-blue-500 text-white px-4 py-2 rounded-lg mt-2" id="sendMessage">Send</button>
    </div>
    </div></div>


    <!-- Footer Section -->
    <footer class="bg-red text-white p-6 mt-10">
        <div class="text-center">
            <p>&copy; 2025 Vitalis. All rights reserved.</p>
        </div>
    </footer>
    </div>
</body>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script>
   

        const USER_ID = "{{ user_id|safe }}";

        let mediaRecorder;
        let audioChunks = [];
        let stream;

        $('#startRecording').on('click', function () {
            navigator.mediaDevices.getUserMedia({ audio: true })
                .then(function (userStream) {
                    stream = userStream;
                    mediaRecorder = new MediaRecorder(stream);
                    audioChunks = [];

                    mediaRecorder.ondataavailable = function (event) {
                        audioChunks.push(event.data);
                    };

                    mediaRecorder.onstop = function () {
                        let audioBlob = new Blob(audioChunks, { type: 'audio/wav' });
                        let formData = new FormData();
                        formData.append('audio', audioBlob, 'audio.wav');
                        const placeholder = $('<div>')
                            .addClass('user-message')
                            .text('üé§ Listening...');
                        $('#chatBox').append(placeholder);
                        $('#chatBox').scrollTop($('#chatBox')[0].scrollHeight);

                        $.ajax({
                            url: '/transcribe/',  // Adjust this route if needed
                            type: 'POST',
                            data: formData,
                            contentType: false,
                            processData: false,
                            success: function (transcribeResponse) {
                                const userInput = transcribeResponse.user_input;
                                placeholder.text(userInput); // Update with actual user text

                                // Second request: send transcribed text to model
                                $.ajax({
                                    url: '/predict/',
                                    type: 'POST',
                                    data: JSON.stringify({ prompt: userInput, user_id: USER_ID }),

                                    success: function (predictResponse) {
                                        appendMessage(predictResponse.prediction, 'bot');

                                        if (predictResponse.audio_url) {
                                            let audio = new Audio(predictResponse.audio_url);
                                            audio.play();
                                        }
                                    },
                                    error: function (err) {
                                        console.log('Error from prediction:', err);
                                    }
                                });
                            },
                            error: function (error) {
                                console.log('Error during transcription:', error);
                            }
                        });

                        const audioUrl = URL.createObjectURL(audioBlob);
                        $('#responseAudio').attr('src', audioUrl);
                    };

                    mediaRecorder.start();
                    $('#startRecording').prop('disabled', true);
                    $('#stopRecording').prop('disabled', false);
                    console.log("üéô Recording started...");
                })
                .catch(function (error) {
                    console.log('Error accessing microphone:', error);
                });
        });

        $('#stopRecording').on('click', function () {
            if (mediaRecorder && mediaRecorder.state === "recording") {
                mediaRecorder.stop();
                stream.getTracks().forEach(track => track.stop());
                $('#startRecording').prop('disabled', false);
                $('#stopRecording').prop('disabled', true);
                console.log("‚úÖ Recording stopped.");
            }
        });

        function appendMessage(message, sender) {
            const chatBox = $('#chatBox');
            const messageElement = $('<div>')
                .addClass(sender === 'user' ? 'user-message' : 'bot-message')
                .text(message);
            chatBox.append(messageElement);
            chatBox.scrollTop(chatBox[0].scrollHeight);
        }

        $('#sendMessage').on('click', function () {
            const userMessage = $('#textMessage').val().trim();
            if (!userMessage) return;

            appendMessage(userMessage, 'user');
            $('#textMessage').val('');

            $.ajax({
                url: '/predict/',
                type: 'POST',
                data: JSON.stringify({ prompt: userMessage, user_id: USER_ID }),
                contentType: 'application/json',
                success: function (response) {
                    appendMessage(response.prediction, 'bot');
                },
                error: function (error) {
                    console.log('Error:', error);
                }
            });
        });

    </script>


</script>
</html>
